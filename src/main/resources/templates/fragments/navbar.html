<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8"/>
    <title>Navigation bar fragments</title>
    <link rel="icon" type="image/svg+xml" th:href="@{/favicon.svg}">
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
<nav th:fragment="topbar" style="background:#1f2327;color:#fff;padding:10px 14px;display:flex;gap:14px;align-items:center;">
    <a th:href="@{/}" style="color:#fff;text-decoration:none;font-weight:700;" th:text="#{nav.brand}">Book Store</a>

    <!-- EMPLOYEE -->
    <a sec:authorize="hasAnyRole('EMPLOYEE')" th:href="@{/employees/orders}"
       style="color:#ffd54f;text-decoration:none;" th:text="#{nav.employee.orders}">Manage orders
    </a>

    <a sec:authorize="hasAnyRole('EMPLOYEE')" th:href="@{/employees/books}"
       style="color:#ffd54f;text-decoration:none;" th:text="#{nav.employee.books}">Manage books
    </a>

    <a sec:authorize="hasAnyRole('EMPLOYEE')" th:href="@{/employees/clients}"
       style="color:#ffd54f;text-decoration:none;" th:text="#{nav.employee.clients}">Clients
    </a>

    <!-- CLIENT -->
    <a sec:authorize="hasAnyRole('CLIENT')" th:href="@{/orders/my}"
       style="color:#ffd54f;text-decoration:none;" th:text="#{nav.client.myOrders}">My orders
    </a>

    <!-- CLIENT balance + cart -->
    <div style="margin-left:auto;display:flex;gap:12px;align-items:center;">
        <div sec:authorize="hasAnyRole('CLIENT')" style="display:flex;gap:10px;align-items:center;">
            <span style="color:#cfd8dc;">
                <span th:text="#{nav.client.balance}">Balance</span>:
                <b th:text="${clientBalance}">0.00</b>â‚´
            </span>
            <a th:href="@{/clients/recharge}" class="btn btn-dark" th:text="#{nav.client.recharge}">
                Recharge
            </a>
        </div>

        <div sec:authorize="hasAnyRole('CLIENT')" style="display:flex;gap:10px;align-items:center;">
            <a th:href="@{/cart}" class="btn btn-dark" th:text="#{nav.client.cart}">
                Cart
            </a>
        </div>

        <!-- Language -->
        <div th:insert="~{fragments/navbar :: locale}"></div>

        <!-- Login / Logout -->
        <!-- CLIENT -->
        <div sec:authorize="hasAnyRole('CLIENT')" style="display:flex;gap:10px;align-items:center;">
            <a th:href="@{clients/profile}"
               style="color:#cfd8dc;text-decoration:none;"
               th:text="${#authentication.name}">
                user@email
            </a>

            <form th:action="@{/auth/logout}" method="post" style="margin:0;">
                <!--            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>-->
                <button type="submit" style="background:#2b3137;color:#fff;border:1px solid #3a424a;border-radius:6px;padding:6px 10px;cursor:pointer;" th:text="#{nav.logout}">
                    Logout
                </button>
            </form>
        </div>

        <!-- EMPLOYEE -->
        <div sec:authorize="hasAnyRole('EMPLOYEE')" style="display:flex;gap:10px;align-items:center;">
            <a th:href="@{employees/profile}"
               style="color:#cfd8dc;text-decoration:none;"
               th:text="${#authentication.name}">
                user@email
            </a>

            <form th:action="@{/auth/logout}" method="post" style="margin:0;">
                <!--            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>-->
                <button type="submit" style="background:#2b3137;color:#fff;border:1px solid #3a424a;border-radius:6px;padding:6px 10px;cursor:pointer;" th:text="#{nav.logout}">
                    Logout
                </button>
            </form>
        </div>

        <!-- Guest -->
        <div sec:authorize="!isAuthenticated()">
            <a th:href="@{/auth/login}" style="color:#fff;text-decoration:none;" th:text="#{nav.login}">
                Login
            </a>
        </div>
    </div>
</nav>

<div th:fragment="locale">
    <form method="get">
        <select name="lang" onchange="this.form.submit()">
            <option value="en" th:selected="${#locale.language=='en'}">EN</option>
            <option value="uk" th:selected="${#locale.language=='uk'}">UK</option>
        </select>
    </form>
</div>

<!--<div style="margin-left:auto;display:flex;gap:8px;align-items:center;" th:fragment="locale">-->
<!--    <form action="">-->
<!--        <select name="lang" onchange="this.form.submit()">-->
<!--            <option></option>-->
<!--            <option style="color:#fff;text-decoration:none;" value="en">EN</option>-->
<!--            <option style="color:#fff;text-decoration:none;" value="uk">UK</option>-->
<!--        </select>-->
<!--    </form>-->
<!--</div>-->

<!--<div th:fragment="locale" style="display:flex;align-items:center;gap:8px;">-->
<!--    <style>-->
<!--        .lang-switch { display:flex; gap:6px; padding:4px; border:1px solid #3a424a; border-radius:10px; background:#2b3137; }-->
<!--        .lang-link { display:inline-flex; align-items:center; justify-content:center; min-width:38px; height:28px;-->
<!--            padding:0 10px; border-radius:8px; text-decoration:none; font-weight:700; font-size:12px;-->
<!--            color:#cfd8dc; }-->
<!--        .lang-link:hover { background:#343b43; color:#fff; }-->
<!--        .lang-active { background:#ffd54f; color:#1f2327; }-->
<!--    </style>-->

<!--    <div class="lang-switch" aria-label="Language switcher">-->
<!--        <form method="get" th:action="@{${#request.requestURI}}">-->
<!--            <select name="lang" onchange="this.form.submit()"-->
<!--                    style="background:#2b3137;color:#fff;border:1px solid #3a424a;border-radius:8px;padding:6px 10px;cursor:pointer;">-->
<!--                <option value="en" th:selected="${#locale.language == 'en'}">EN</option>-->
<!--                <option value="uk" th:selected="${#locale.language == 'uk'}">UK</option>-->
<!--            </select>-->
<!--        </form>-->
<!--    </div>-->
<!--</div>-->
</body>
</html>